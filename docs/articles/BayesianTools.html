<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bayesian Tools • BayesianTools</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">BayesianTools</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/BayesianTools.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/florianhartig/BayesianTools">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Bayesian Tools</h1>
            
          </div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      <p>The BayesianTools (BT) package supports model analysis (including sensitivity analysis and uncertainty analysis), Bayesian model calibration, as well as model selection and multi-model inference techniques for system models.</p>
    </div>
    
<div class="contents">
<div id="quick-start" class="section level1">
<h1 class="hasAnchor">
<a href="#quick-start" class="anchor"></a>Quick start</h1>
<p>The purpose of this first section is to give you a quick overview of the most important functions of the BayesianTools (BT) package. For a more detailed description, see the later sections</p>
<div id="installing-loading-and-citing-the-package" class="section level2">
<h2 class="hasAnchor">
<a href="#installing-loading-and-citing-the-package" class="anchor"></a>Installing, loading and citing the package</h2>
<p>If you haven’t installed the package yet, either run</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">"BayesianTools"</span>)</code></pre></div>
<p>Or follow the instructions on <a href="https://github.com/florianhartig/BayesianTools" class="uri">https://github.com/florianhartig/BayesianTools</a> to install a development or an older version.</p>
<p>Loading and citation</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(BayesianTools)
<span class="kw">citation</span>(<span class="st">"BayesianTools"</span>)</code></pre></div>
<pre><code>## 
## To cite package 'BayesianTools' in publications use:
## 
##   Florian Hartig, Francesco Minunno and Stefan Paul (2017).
##   BayesianTools: General-Purpose MCMC and SMC Samplers and Tools
##   for Bayesian Statistics. R package version 0.1.4.
##   https://github.com/florianhartig/BayesianTools
## 
## A BibTeX entry for LaTeX users is
## 
##   @Manual{,
##     title = {BayesianTools: General-Purpose MCMC and SMC Samplers and Tools for Bayesian Statistics},
##     author = {Florian Hartig and Francesco Minunno and Stefan { Paul}},
##     year = {2017},
##     note = {R package version 0.1.4},
##     url = {https://github.com/florianhartig/BayesianTools},
##   }</code></pre>
<p>Note: BayesianTools calls a number of secondary packages. Particular important is coda, which is used on a number of plots and summary statistics. If you make heavy use of the summary statistics and diagnostics plots, it would be nice to cite coda as well!</p>
<p>Pro-tip: if you are running a stochastic algorithms such as an MCMC, you should always set or record your random seed to make your results reproducible (otherwise, results will change slightly every time you run the code)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">123</span>)</code></pre></div>
<p>In a real application, to ensure reproducibility, it would also be useful to record the session</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sessionInfo</span>()</code></pre></div>
<p>which lists the version number of R and all loaded packages.</p>
</div>
<div id="the-bayesian-setup" class="section level2">
<h2 class="hasAnchor">
<a href="#the-bayesian-setup" class="anchor"></a>The Bayesian Setup</h2>
<p>The central object in the BT package is the BayesianSetup. This class contains the information about the model to be fit (likelihood), and the priors for the model parameters.</p>
<p>A BayesianSetup is created by the createBayesianSetup function. The function expects a log-likelihood and (optional) a log-prior. It then automatically creates the posterior and various convenience functions for the samplers.</p>
<p>Advantages of the BayesianSetup include
1. support for automatic parallelization
2. functions are wrapped in try-catch statements to avoid crashes during long MCMC evaluations
3. and the posterior checks if the parameter is outside the prior first, in which case the likelihood is not evaluated (makes the algorithms faster for slow likelihoods).</p>
<p>If no prior information is provided, an unbounded flat prior is created. If no explicit prior, but lower and upper values are provided, a standard uniform prior with the respective bounds is created, including the option to sample from this prior, which is useful for SMC and also for getting starting values. This option is used in the following example, which creates a multivariate normal likelihood density and a uniform prior for 3 parameters.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ll &lt;-<span class="st"> </span><span class="kw"><a href="../reference/generateTestDensityMultiNormal.html">generateTestDensityMultiNormal</a></span>(<span class="dt">sigma =</span> <span class="st">"no correlation"</span>)
bayesianSetup =<span class="st"> </span><span class="kw"><a href="../reference/createBayesianSetup.html">createBayesianSetup</a></span>(<span class="dt">likelihood =</span> ll, <span class="dt">lower =</span> <span class="kw">rep</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">3</span>), <span class="dt">upper =</span> <span class="kw">rep</span>(<span class="dv">10</span>, <span class="dv">3</span>))</code></pre></div>
<p>See later more detailed description about the BayesianSetup.</p>
<p><strong>Hint:</strong> for an example how to run this steps for dynamic ecological model, see ?VSEM</p>
</div>
<div id="running-mcmc-and-smc-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#running-mcmc-and-smc-functions" class="anchor"></a>Running MCMC and SMC functions</h2>
<p>Once you have your setup, you may want to run a calibration. The runMCMC function is the main wrapper for all other implemented MCMC/SMC functions. It always takes the following arguments</p>
<ul>
<li>A bayesianSetup (alternatively, the log target function)</li>
<li>The sampler name</li>
<li>A list with settings - if a parameter is not provided, the default will be used</li>
</ul>
<p>As an example, choosing the sampler name “Metropolis” calls a versatile Metropolis-type MCMC with options for covariance adaptation, delayed rejection, tempering and Metropolis-within-Gibbs sampling. For details, see the the later reference on MCMC samplers. This is how we would call this sampler with default settings</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iter =<span class="st"> </span><span class="dv">10000</span>
settings =<span class="st"> </span><span class="kw">list</span>(<span class="dt">iterations =</span> iter, <span class="dt">message =</span> <span class="ot">FALSE</span>)
out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMCMC.html">runMCMC</a></span>(<span class="dt">bayesianSetup =</span> bayesianSetup, <span class="dt">sampler =</span> <span class="st">"Metropolis"</span>, <span class="dt">settings =</span> settings)</code></pre></div>
<div id="summarizing-outputs" class="section level4">
<h4 class="hasAnchor">
<a href="#summarizing-outputs" class="anchor"></a>Summarizing outputs</h4>
<p>All samplers can be plotted and summarized via the console with the standard print, and summary commands</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(out)</code></pre></div>
<pre><code>## [1] "mcmcSampler - you can use the following methods to summarize, plot or reduce this class:"
## [1] getSample plot      print     summary  
## see '?methods' for accessing help and source code</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(out)</code></pre></div>
<pre><code>## # # # # # # # # # # # # # # # # # # # # # # # # # 
## ## MCMC chain summary ## 
## # # # # # # # # # # # # # # # # # # # # # # # # # 
##  
## # MCMC sampler:  Metropolis 
## # Nr. Chains:  1 
## # Iterations per chain:  10000 
## # Rejection rate:  0.686 
## # Effective sample size:  932 
## # Runtime:  3.06  sec. 
##  
## # Parameters
##          MAP   2.5% median 97.5%
## par 1  0.001 -1.981  0.022 2.050
## par 2  0.000 -2.095 -0.060 1.968
## par 3 -0.001 -2.085 -0.048 1.967
## 
## ## DIC:  11.72 
## ## Convergence 
##  Gelman Rubin multivariate psrf:  Only one chain; convergence cannot be determined! 
##  
## ## Correlations 
##        par 1 par 2  par 3
## par 1  1.000 0.004 -0.005
## par 2  0.004 1.000  0.017
## par 3 -0.005 0.017  1.000</code></pre>
<p>and plottted with several plot functions. The marginalPlot can either be plotted as histograms with density overlay, which is also the default, or as a violin plot (see “?marginalPlot”).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(out) <span class="co"># plot internally calls tracePlot(out)</span></code></pre></div>
<p><img src="BayesianTools_files/figure-html/unnamed-chunk-9-1.png" width="480"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/correlationPlot.html">correlationPlot</a></span>(out)</code></pre></div>
<p><img src="BayesianTools_files/figure-html/unnamed-chunk-9-2.png" width="480"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/marginalPlot.html">marginalPlot</a></span>(out)</code></pre></div>
<p><img src="BayesianTools_files/figure-html/unnamed-chunk-9-3.png" width="480"></p>
<p>Other Functions that can be applied to all samplers include model selection scores such as the DIC and the marginal Likelihood (for the calculation of the Bayes factor, see later section for more details), and the Maximum Aposteriori Value (MAP). For the marginal likelihood calculation it is possible to chose from a set of methods (see “?marginalLikelihood”).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/marginalLikelihood.html">marginalLikelihood</a></span>(out)</code></pre></div>
<pre><code>## $ln.ML
## [1] -8.969702
## 
## $ln.lik.star
## [1] -2.756817
## 
## $ln.pi.star
## [1] -8.987197
## 
## $ln.pi.hat
## [1] -2.774312
## 
## $method
## [1] "Chib"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/DIC.html">DIC</a></span>(out)</code></pre></div>
<pre><code>## $DIC
## [1] 11.72016
## 
## $IC
## [1] 14.81802
## 
## $pD
## [1] 3.097861
## 
## $pV
## [1] 3.411328
## 
## $Dbar
## [1] 8.622295
## 
## $Dhat
## [1] 5.524434</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/MAP.html">MAP</a></span>(out)</code></pre></div>
<pre><code>## $parametersMAP
##         par 1         par 2         par 3 
##  1.000968e-03  6.672794e-05 -9.910697e-04 
## 
## $valuesMAP
##  Lposterior Llikelihood      Lprior 
##  -11.744013   -2.756817   -8.987197</code></pre>
<p>You can extract (a part of) the sampled parameter values by</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/getSample.html">getSample</a></span>(out, <span class="dt">start =</span> <span class="dv">100</span>, <span class="dt">end =</span> <span class="ot">NULL</span>, <span class="dt">thin =</span> <span class="dv">5</span>, <span class="dt">whichParameters =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)</code></pre></div>
<p>For all samplers, you can conveniently perform multiple runs via the nrChains argument</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iter =<span class="st"> </span><span class="dv">1000</span>
settings =<span class="st"> </span><span class="kw">list</span>(<span class="dt">iterations =</span> iter, <span class="dt">nrChains =</span> <span class="dv">3</span>, <span class="dt">message =</span> <span class="ot">FALSE</span>)
out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMCMC.html">runMCMC</a></span>(<span class="dt">bayesianSetup =</span> bayesianSetup, <span class="dt">sampler =</span> <span class="st">"Metropolis"</span>, <span class="dt">settings =</span> settings)</code></pre></div>
<p>The result is an object of mcmcSamplerList, which should allow to do everything one can do with an mcmcSampler object (with slightly different output sometimes).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(out)</code></pre></div>
<pre><code>## [1] "mcmcSamplerList - you can use the following methods to summarize, plot or reduce this class:"
## [1] getSample plot      print     summary  
## see '?methods' for accessing help and source code</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(out)</code></pre></div>
<pre><code>## # # # # # # # # # # # # # # # # # # # # # # # # # 
## ## MCMC chain summary ## 
## # # # # # # # # # # # # # # # # # # # # # # # # # 
##  
## # MCMC sampler:  Metropolis 
## # Nr. Chains:  3 
## # Iterations per chain:  1000 
## # Rejection rate:  0.688 
## # Effective sample size:  301 
## # Runtime:  1.11  sec. 
##  
## # Parameters
##         psf    MAP   2.5% median 97.5%
## par 1 1.004 -0.001 -1.937 -0.093 2.010
## par 2 1.004  0.000 -1.997  0.067 1.807
## par 3 1.027  0.000 -1.787  0.127 1.994
## 
## ## DIC:  11.212 
## ## Convergence 
##  Gelman Rubin multivariate psrf:  1.015 
##  
## ## Correlations 
##        par 1  par 2  par 3
## par 1  1.000 -0.062 -0.049
## par 2 -0.062  1.000  0.065
## par 3 -0.049  0.065  1.000</code></pre>
<p>For example, in the plot you now see 3 chains.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(out)</code></pre></div>
<p><img src="BayesianTools_files/figure-html/unnamed-chunk-14-1.png" width="480"></p>
<p>There are a few additional functions that may only be available for lists, for example convergence checks</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#getSample(out, coda = F)</span>
<span class="kw"><a href="../reference/gelmanDiagnostics.html">gelmanDiagnostics</a></span>(out, <span class="dt">plot =</span> T)</code></pre></div>
<p><img src="BayesianTools_files/figure-html/unnamed-chunk-15-1.png" width="480"></p>
<pre><code>## Potential scale reduction factors:
## 
##       Point est. Upper C.I.
## par 1       1.00       1.02
## par 2       1.00       1.01
## par 3       1.03       1.06
## 
## Multivariate psrf
## 
## 1.02</code></pre>
</div>
<div id="which-sampler-to-choose" class="section level4">
<h4 class="hasAnchor">
<a href="#which-sampler-to-choose" class="anchor"></a>Which sampler to choose?</h4>
<p>The BT package provides a large class of different MCMC samplers, and it depends on the particular application which is most suitable.</p>
<p>In the absence of further information, we currently recommend the DEzs sampler. This is also the default in the runMCMC function.</p>
</div>
</div>
</div>
<div id="bayesiansetup-reference" class="section level1">
<h1 class="hasAnchor">
<a href="#bayesiansetup-reference" class="anchor"></a>BayesianSetup Reference</h1>
<div id="reference-on-creating-likelihoods" class="section level2">
<h2 class="hasAnchor">
<a href="#reference-on-creating-likelihoods" class="anchor"></a>Reference on creating likelihoods</h2>
<p>The likelihood should be provided as a log density function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ll =<span class="st"> </span><span class="kw">logDensity</span>(x)</code></pre></div>
<p>See options for parallelization below. We will use a simple 3-d multivariate normal density for this demonstration.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ll &lt;-<span class="st"> </span><span class="kw"><a href="../reference/generateTestDensityMultiNormal.html">generateTestDensityMultiNormal</a></span>(<span class="dt">sigma =</span> <span class="st">"no correlation"</span>)
bayesianSetup =<span class="st"> </span><span class="kw"><a href="../reference/createBayesianSetup.html">createBayesianSetup</a></span>(<span class="dt">likelihood =</span> ll, <span class="dt">lower =</span> <span class="kw">rep</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">3</span>), <span class="dt">upper =</span> <span class="kw">rep</span>(<span class="dv">10</span>, <span class="dv">3</span>))</code></pre></div>
<div id="parallelization-of-the-likelihood-evaluations" class="section level4">
<h4 class="hasAnchor">
<a href="#parallelization-of-the-likelihood-evaluations" class="anchor"></a>Parallelization of the likelihood evaluations</h4>
<p>Likelihoods are often costly to compute. If that is the case for you, you should think about parallelization possibilities. The ‘createBayesianSetup’ function has the input variable ‘parallel’, with the following options</p>
<ul>
<li>F / FALSE means no parallelization should be used</li>
<li>T / TRUE means that automatic parallelization options from R are used (careful: this will not work if your likelihood writes to file, or uses global variables or functions - see general R help on parallelization)</li>
<li>“external”, assumed that the likelihood is already parallelized. In this case, the function needs to accept a matrix with parameters as columns, and rows as the different model runs you want to evaluate. This is the most likely option to use if you have a complicated setup (file I/O, HPC cluster) that cannot be treated with the standard R parallelization.</li>
</ul>
<p>Algorithms in the BayesianTools package can make use of parallel computing if this option is specified in the BayesianSetup. Note that currently, parallelization is used by the following algorithms: SMC, DEzs and DREAMzs sampler. It can also be used through the BayesianSetup with the functions of the sensitivity package.</p>
<p>Here some more details on the parallelization</p>
</div>
<div id="in-build-parallelization" class="section level4">
<h4 class="hasAnchor">
<a href="#in-build-parallelization" class="anchor"></a>1. In-build parallelization:</h4>
<p>The in-build parallelization is the easiest way to make use of parallel computing. In the “parallel” argument you can choose the number of cores used for parallelization. Alternatively for TRUE or “auto” all available cores except for one will be used. Now the proposals are evaluated in parallel. Technically, the in-build parallelization uses an R cluster to evaluate the posterior density function. The input for the parallel function is a matrix, where each column represents a parameter and each row a proposal. In this way, the proposals can be evaluated in parallel. For sampler, where only one proposal is evaluated at a time (namely the Metropolis based algorithms as well as DE/DREAM without the zs extension), no parallelization can be used.</p>
</div>
<div id="external-parallelization" class="section level4">
<h4 class="hasAnchor">
<a href="#external-parallelization" class="anchor"></a>2. External parallelization</h4>
<p>The second option is to use an external parallelization. Here, a parallelization is attempted in the user defined likelihood function. To make use of external parallelization, the likelihood function needs to take a matrix of proposals and return a vector of likelihood values. In the proposal matrix each row represents one proposal, each column a parameter. Further, you need to specify the “external” parallelization in the “parallel” argument. In simplified terms the use of external parallelization uses the following steps:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Definition of likelihood function
likelihood &lt;-<span class="st"> </span><span class="cf">function</span>(matrix){
    <span class="co"># Calculate likelihood in parallel</span>
    <span class="co"># Return vector of likelihood valus</span>
}

## Create Bayesian Setup
BS &lt;-<span class="st"> </span><span class="kw"><a href="../reference/createBayesianSetup.html">createBayesianSetup</a></span>(likelihood, <span class="dt">parallel =</span> <span class="st">"external"</span> ...)

## Run MCMC
<span class="kw"><a href="../reference/runMCMC.html">runMCMC</a></span>(BS, <span class="dt">sampler =</span> <span class="st">"SMC"</span>, ...)</code></pre></div>
<p>** Remark: even though parallelization can significantly reduce the computation time, it is not always useful because of the so-called communication overhead (computational time for distributing and retrieving infos from the parallel cores). For models with low computational cost, this procedure can take more time than the actual evaluation of the likelihood. If in doubt, make a small comparison of the runtime before starting your large sampling. **</p>
</div>
</div>
<div id="reference-on-creating-priors" class="section level2">
<h2 class="hasAnchor">
<a href="#reference-on-creating-priors" class="anchor"></a>Reference on creating priors</h2>
<p>The prior in the BayesianSetup consists of four parts</p>
<ul>
<li>A log density function</li>
<li>An (optional) sampling function (must be a function without parameters, that returns a draw from the prior)</li>
<li>lower / upper boundaries</li>
<li>Additional info - best values, names of the parameters, …</li>
</ul>
<p>These information can be passed by first creating an a extra object, via createPrior, or through the createBayesianSetup function.</p>
<div id="creating-priors" class="section level4">
<h4 class="hasAnchor">
<a href="#creating-priors" class="anchor"></a>Creating priors</h4>
<p>You have 5 options to create a prior</p>
<ul>
<li>Do not set a prior - in this case, an infinite prior will be created</li>
<li>Set min/max values - a bounded flat prior and the corresponding sampling function will be created</li>
<li>Use one of the pre-definded priors, see ?createPrior for a list. One of the options here is to use a previous MCMC output as new prior. Pre-defined priors will usually come with a sampling function</li>
<li>Use a user-define prior, see ?createPrior</li>
<li>Create a prior from a previous MCMC sample</li>
</ul>
</div>
<div id="creating-user-defined-priors" class="section level4">
<h4 class="hasAnchor">
<a href="#creating-user-defined-priors" class="anchor"></a>Creating user-defined priors</h4>
<p>If creating a user-defined prior, the following information can/should be provided to createPrior:</p>
<ul>
<li>A log density function, as a function of a parameter vector x, same syntax as the likelihood</li>
<li>Additionally, you should consider providing a function that samples from the prior, because many samplers (SMC, DE, DREAM) can make use of this function for initial conditions. If you use one of the pre-defined priors, the sampling function is already implemented</li>
<li>lower / upper boundaries (can be set on top of any prior, to create truncation)</li>
<li>Additional info - best values, names of the parameters, …</li>
</ul>
</div>
<div id="creating-a-prior-from-a-previous-mcmc-sample" class="section level4">
<h4 class="hasAnchor">
<a href="#creating-a-prior-from-a-previous-mcmc-sample" class="anchor"></a>Creating a prior from a previous MCMC sample</h4>
<p>The following example from the help shows how this works</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create a BayesianSetup</span>
ll &lt;-<span class="st"> </span><span class="kw"><a href="../reference/generateTestDensityMultiNormal.html">generateTestDensityMultiNormal</a></span>(<span class="dt">sigma =</span> <span class="st">"no correlation"</span>)
bayesianSetup =<span class="st"> </span><span class="kw"><a href="../reference/createBayesianSetup.html">createBayesianSetup</a></span>(<span class="dt">likelihood =</span> ll, <span class="dt">lower =</span> <span class="kw">rep</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">3</span>), <span class="dt">upper =</span> <span class="kw">rep</span>(<span class="dv">10</span>, <span class="dv">3</span>))

settings =<span class="st"> </span><span class="kw">list</span>(<span class="dt">iterations =</span> <span class="dv">2500</span>,  <span class="dt">message =</span> <span class="ot">FALSE</span>)
out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMCMC.html">runMCMC</a></span>(<span class="dt">bayesianSetup =</span> bayesianSetup, <span class="dt">settings =</span> settings)


newPrior =<span class="st"> </span><span class="kw"><a href="../reference/createPriorDensity.html">createPriorDensity</a></span>(out, <span class="dt">method =</span> <span class="st">"multivariate"</span>, <span class="dt">eps =</span> <span class="fl">1e-10</span>, <span class="dt">lower =</span> <span class="kw">rep</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">3</span>), <span class="dt">upper =</span>  <span class="kw">rep</span>(<span class="dv">10</span>, <span class="dv">3</span>), <span class="dt">best =</span> <span class="ot">NULL</span>)
bayesianSetup &lt;-<span class="st"> </span><span class="kw"><a href="../reference/createBayesianSetup.html">createBayesianSetup</a></span>(<span class="dt">likelihood =</span> ll, <span class="dt">prior =</span> newPrior)

settings =<span class="st"> </span><span class="kw">list</span>(<span class="dt">iterations =</span> <span class="dv">1000</span>,  <span class="dt">message =</span> <span class="ot">FALSE</span>)
out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMCMC.html">runMCMC</a></span>(<span class="dt">bayesianSetup =</span> bayesianSetup, <span class="dt">settings =</span> settings)</code></pre></div>
</div>
</div>
</div>
<div id="mcmc-sampler-reference" class="section level1">
<h1 class="hasAnchor">
<a href="#mcmc-sampler-reference" class="anchor"></a>MCMC sampler reference</h1>
<div id="runmcmc" class="section level2">
<h2 class="hasAnchor">
<a href="#runmcmc" class="anchor"></a>runMCMC</h2>
<p>The runMCMC function is the central function for starting MCMC algorithms in the BayesianTools package. It requires a bayesianSetup, a choice of sampler (standard is DEzs), and optionally changes to the standard settings of the chosen sampler.</p>
<p>runMCMC(bayesianSetup, sampler = “DEzs”, settings = NULL)</p>
<p>One optional argument that you can always use is nrChains - the default is 1. If you choose more, the runMCMC will perform several runs.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ll &lt;-<span class="st"> </span><span class="kw"><a href="../reference/generateTestDensityMultiNormal.html">generateTestDensityMultiNormal</a></span>(<span class="dt">sigma =</span> <span class="st">"no correlation"</span>)

bayesianSetup =<span class="st"> </span><span class="kw"><a href="../reference/createBayesianSetup.html">createBayesianSetup</a></span>(<span class="dt">likelihood =</span> ll, <span class="dt">lower =</span> <span class="kw">rep</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">3</span>), <span class="dt">upper =</span> <span class="kw">rep</span>(<span class="dv">10</span>, <span class="dv">3</span>))

settings =<span class="st"> </span><span class="kw">list</span>(<span class="dt">iterations =</span> <span class="dv">10000</span>, <span class="dt">nrChains=</span> <span class="dv">3</span>, <span class="dt">message =</span> <span class="ot">FALSE</span>)
out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMCMC.html">runMCMC</a></span>(<span class="dt">bayesianSetup =</span> bayesianSetup, <span class="dt">sampler =</span> <span class="st">"Metropolis"</span>, <span class="dt">settings =</span> settings)

<span class="kw">plot</span>(out)</code></pre></div>
<p><img src="BayesianTools_files/figure-html/unnamed-chunk-20-1.png" width="480"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/marginalPlot.html">marginalPlot</a></span>(out)</code></pre></div>
<p><img src="BayesianTools_files/figure-html/unnamed-chunk-20-2.png" width="480"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/correlationPlot.html">correlationPlot</a></span>(out)</code></pre></div>
<p><img src="BayesianTools_files/figure-html/unnamed-chunk-20-3.png" width="480"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/gelmanDiagnostics.html">gelmanDiagnostics</a></span>(out, <span class="dt">plot=</span>T)</code></pre></div>
<p><img src="BayesianTools_files/figure-html/unnamed-chunk-20-4.png" width="480"></p>
<pre><code>## Potential scale reduction factors:
## 
##       Point est. Upper C.I.
## par 1          1       1.00
## par 2          1       1.00
## par 3          1       1.01
## 
## Multivariate psrf
## 
## 1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># option to restart the sampler</span>

settings =<span class="st"> </span><span class="kw">list</span>(<span class="dt">iterations =</span> <span class="dv">1000</span>, <span class="dt">nrChains=</span> <span class="dv">1</span>, <span class="dt">message =</span> <span class="ot">FALSE</span>)
out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMCMC.html">runMCMC</a></span>(<span class="dt">bayesianSetup =</span> bayesianSetup, <span class="dt">sampler =</span> <span class="st">"Metropolis"</span>, <span class="dt">settings =</span> settings)

out2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMCMC.html">runMCMC</a></span>(<span class="dt">bayesianSetup =</span> out)

out3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMCMC.html">runMCMC</a></span>(<span class="dt">bayesianSetup =</span> out2)

<span class="co">#plot(out)</span>
<span class="co">#plot(out3)</span>

<span class="co"># create new prior from posterior sample </span>

newPriorFromPosterior &lt;-<span class="st"> </span><span class="kw"><a href="../reference/createPriorDensity.html">createPriorDensity</a></span>(out2)</code></pre></div>
</div>
<div id="the-different-mcmc-samplers" class="section level2">
<h2 class="hasAnchor">
<a href="#the-different-mcmc-samplers" class="anchor"></a>The different MCMC samplers</h2>
<p>For convenience we define a number of iterations</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iter =<span class="st"> </span><span class="dv">10000</span></code></pre></div>
<div id="the-metropolis-mcmc-class" class="section level3">
<h3 class="hasAnchor">
<a href="#the-metropolis-mcmc-class" class="anchor"></a>The Metropolis MCMC class</h3>
<p>The BayesianTools package is able to run a large number of Metropolis-Hastings (MH) based algorithms All of these samplers can be accessed by the “Metropolis” sampler in the runMCMC function by specifying the sampler’s settings.</p>
<p>The following code gives an overview about the default settings of the MH sampler.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/applySettingsDefault.html">applySettingsDefault</a></span>(<span class="dt">sampler =</span> <span class="st">"Metropolis"</span>)</code></pre></div>
<pre><code>## $sampler
## [1] "Metropolis"
## 
## $startValue
## NULL
## 
## $iterations
## [1] 10000
## 
## $optimize
## [1] TRUE
## 
## $proposalGenerator
## NULL
## 
## $consoleUpdates
## [1] 100
## 
## $burnin
## [1] 0
## 
## $thin
## [1] 1
## 
## $parallel
## NULL
## 
## $adapt
## [1] TRUE
## 
## $adaptationInterval
## [1] 500
## 
## $adaptationNotBefore
## [1] 3000
## 
## $DRlevels
## [1] 1
## 
## $proposalScaling
## NULL
## 
## $adaptationDepth
## NULL
## 
## $temperingFunction
## NULL
## 
## $gibbsProbabilities
## NULL
## 
## $currentChain
## [1] 1
## 
## $message
## [1] TRUE
## 
## $nrChains
## [1] 1
## 
## $runtime
## [1] 0
## 
## $sessionInfo
## R version 3.4.3 (2017-11-30)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 8.1 x64 (build 9600)
## 
## Matrix products: default
## 
## locale:
## [1] LC_COLLATE=German_Germany.1252  LC_CTYPE=German_Germany.1252   
## [3] LC_MONETARY=German_Germany.1252 LC_NUMERIC=C                   
## [5] LC_TIME=German_Germany.1252    
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] BayesianTools_0.1.4
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_0.12.14         DHARMa_0.1.5         knitr_1.18          
##  [4] magrittr_1.5         MASS_7.3-47          tmvtnorm_1.4-10     
##  [7] lattice_0.20-35      bridgesampling_0.4-0 foreach_1.4.4       
## [10] stringr_1.2.0        tools_3.4.3          grid_3.4.3          
## [13] coda_0.19-1          htmltools_0.3.6      IDPmisc_1.1.17      
## [16] iterators_1.0.9      yaml_2.1.16          rprojroot_1.3-2     
## [19] digest_0.6.13        gmm_1.6-1            numDeriv_2016.8-1   
## [22] Brobdingnag_1.2-4    Matrix_1.2-12        codetools_0.2-15    
## [25] evaluate_0.10.1      rmarkdown_1.8        sandwich_2.4-0      
## [28] stringi_1.1.6        compiler_3.4.3       backports_1.1.2     
## [31] stats4_3.4.3         mvtnorm_1.0-6        zoo_1.8-1</code></pre>
<p>The following examples show how the different settings can be used. As you will see different options can be activated singly or in combination.</p>
<div id="standard-mh-mcmc" class="section level4">
<h4 class="hasAnchor">
<a href="#standard-mh-mcmc" class="anchor"></a>Standard MH MCMC</h4>
<p>The following settings will run the standard Metropolis Hastings MCMC.</p>
<p>Refernences: Hastings, W. K. (1970). Monte carlo sampling methods using markov chains and their applications. Biometrika 57 (1), 97-109.</p>
<p>Metropolis, N., A. W. Rosenbluth, M. N. Rosenbluth, A. H. Teller, and E. Teller (1953). Equation of state calculations by fast computing machines. The journal of chemical physics 21 (6), 1087 - 1092.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">settings &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">iterations =</span> iter, <span class="dt">adapt =</span> F, <span class="dt">DRlevels =</span> <span class="dv">1</span>, <span class="dt">gibbsProbabilities =</span> <span class="ot">NULL</span>, <span class="dt">temperingFunction =</span> <span class="ot">NULL</span>, <span class="dt">optimize =</span> F, <span class="dt">message =</span> <span class="ot">FALSE</span>)
out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMCMC.html">runMCMC</a></span>(<span class="dt">bayesianSetup =</span> bayesianSetup, <span class="dt">sampler =</span> <span class="st">"Metropolis"</span>, <span class="dt">settings =</span> settings)
<span class="kw">plot</span>(out) </code></pre></div>
</div>
<div id="standard-mh-mcmc-prior-optimization" class="section level4">
<h4 class="hasAnchor">
<a href="#standard-mh-mcmc-prior-optimization" class="anchor"></a>Standard MH MCMC, prior optimization</h4>
<p>This sampler uses an optimization step prior to the sampling process. The optimization aims at improving the starting values and the covariance of the proposal distribution.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">settings &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">iterations =</span> iter, <span class="dt">adapt =</span> F, <span class="dt">DRlevels =</span> <span class="dv">1</span>, <span class="dt">gibbsProbabilities =</span> <span class="ot">NULL</span>, <span class="dt">temperingFunction =</span> <span class="ot">NULL</span>, <span class="dt">optimize =</span> T, <span class="dt">message =</span> <span class="ot">FALSE</span>)
out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMCMC.html">runMCMC</a></span>(<span class="dt">bayesianSetup =</span> bayesianSetup, <span class="dt">sampler =</span> <span class="st">"Metropolis"</span>, <span class="dt">settings =</span> settings)
<span class="kw">plot</span>(out) </code></pre></div>
</div>
<div id="adaptive-mcmc-prior-optimization" class="section level4">
<h4 class="hasAnchor">
<a href="#adaptive-mcmc-prior-optimization" class="anchor"></a>Adaptive MCMC, prior optimization</h4>
<p>In the adaptive Metropolis sampler (AM) the information already acquired in the sampling process is used to improve (or adapt) the proposal function. In the BayesianTools package the history of the chain is used to adapt the covariance of the propoasal distribution.</p>
<p>References: Haario, H., E. Saksman, and J. Tamminen (2001). An adaptive metropolis algorithm. Bernoulli , 223-242.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">settings &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">iterations =</span> iter, <span class="dt">adapt =</span> T, <span class="dt">DRlevels =</span> <span class="dv">1</span>, <span class="dt">gibbsProbabilities =</span> <span class="ot">NULL</span>, <span class="dt">temperingFunction =</span> <span class="ot">NULL</span>, <span class="dt">optimize =</span> T,  <span class="dt">message =</span> <span class="ot">FALSE</span>)
out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMCMC.html">runMCMC</a></span>(<span class="dt">bayesianSetup =</span> bayesianSetup, <span class="dt">sampler =</span> <span class="st">"Metropolis"</span>, <span class="dt">settings =</span> settings)
<span class="kw">plot</span>(out) </code></pre></div>
</div>
<div id="standard-mcmc-prior-optimization-delayed-rejection" class="section level4">
<h4 class="hasAnchor">
<a href="#standard-mcmc-prior-optimization-delayed-rejection" class="anchor"></a>Standard MCMC, prior optimization, delayed rejection</h4>
<p>Even though rejection is an essential step of a MCMC algorithm it can also mean that the proposal distribution is (locally) badly tuned to the target distribution. In a delayed rejection (DR) sampler a second (or third, etc.) proposal is made before rejection. This proposal is usually drawn from a different distribution, allowing for a greater flexibility of the sampler. In the BayesianTools package the number of delayed rejection steps as well as the scaling of the proposals can be determined. ** Note that the current version only supports two delayed rejection steps. **</p>
<p>References: Green, Peter J., and Antonietta Mira. “Delayed rejection in reversible jump Metropolis-Hastings.” Biometrika (2001): 1035-1053.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">settings &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">iterations =</span> iter, <span class="dt">adapt =</span> F, <span class="dt">DRlevels =</span> <span class="dv">2</span>, <span class="dt">gibbsProbabilities =</span> <span class="ot">NULL</span>, <span class="dt">temperingFunction =</span> <span class="ot">NULL</span>, <span class="dt">optimize =</span> T,  <span class="dt">message =</span> <span class="ot">FALSE</span>)
out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMCMC.html">runMCMC</a></span>(<span class="dt">bayesianSetup =</span> bayesianSetup, <span class="dt">sampler =</span> <span class="st">"Metropolis"</span>, <span class="dt">settings =</span> settings)
<span class="kw">plot</span>(out) </code></pre></div>
</div>
<div id="adaptive-mcmc-prior-optimization-delayed-rejection" class="section level4">
<h4 class="hasAnchor">
<a href="#adaptive-mcmc-prior-optimization-delayed-rejection" class="anchor"></a>Adaptive MCMC, prior optimization, delayed rejection</h4>
<p>The delayed rejection adaptive Metropolis (DRAM) sampler is merely a combination of the two previous sampler (DR and AM).</p>
<p>References: Haario, Heikki, et al. “DRAM: efficient adaptive MCMC.” Statistics and Computing 16.4 (2006): 339-354.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">settings &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">iterations =</span> iter, <span class="dt">adapt =</span> T, <span class="dt">DRlevels =</span> <span class="dv">2</span>, <span class="dt">gibbsProbabilities =</span> <span class="ot">NULL</span>, <span class="dt">temperingFunction =</span> <span class="ot">NULL</span>, <span class="dt">optimize =</span> T,  <span class="dt">message =</span> <span class="ot">FALSE</span>)
out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMCMC.html">runMCMC</a></span>(<span class="dt">bayesianSetup =</span> bayesianSetup, <span class="dt">sampler =</span> <span class="st">"Metropolis"</span>, <span class="dt">settings =</span> settings)
<span class="kw">plot</span>(out) </code></pre></div>
</div>
<div id="standard-mcmc-prior-optimization-gibbs-updating" class="section level4">
<h4 class="hasAnchor">
<a href="#standard-mcmc-prior-optimization-gibbs-updating" class="anchor"></a>Standard MCMC, prior optimization, Gibbs updating</h4>
<p>To reduce the dimensions of the target function a Metropolis-within-Gibbs sampler can be run with the BayesianTools package. This means in each iteration only a subset of the parameter vector is updated. In the example below at most two (of the three) parameters are updated each step, and it is double as likely to vary one than varying two.</p>
<p>** Note that currently adaptive cannot be mixed with Gibbs updating! **</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">settings &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">iterations =</span> iter, <span class="dt">adapt =</span> T, <span class="dt">DRlevels =</span> <span class="dv">1</span>, <span class="dt">gibbsProbabilities =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="fl">0.5</span>,<span class="dv">0</span>), <span class="dt">temperingFunction =</span> <span class="ot">NULL</span>, <span class="dt">optimize =</span> T,  <span class="dt">message =</span> <span class="ot">FALSE</span>)
out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMCMC.html">runMCMC</a></span>(<span class="dt">bayesianSetup =</span> bayesianSetup, <span class="dt">sampler =</span> <span class="st">"Metropolis"</span>, <span class="dt">settings =</span> settings)
<span class="kw">plot</span>(out) </code></pre></div>
</div>
<div id="standard-mcmc-prior-optimization-gibbs-updating-tempering" class="section level4">
<h4 class="hasAnchor">
<a href="#standard-mcmc-prior-optimization-gibbs-updating-tempering" class="anchor"></a>Standard MCMC, prior optimization, gibbs updating, tempering</h4>
<p>Simulated tempering is closely related to simulated annealing (e.g. Bélisle, 1992) in optimization algorithms. The idea of tempering is to increase the acceptance rate during burn-in. This should result in a faster initial scanning of the target function. To include this a tempering function needs to be supplied by the user. The function describes how the acceptance rate is influenced during burn-in. In the example below an exponential decline approaching 1 (= no influece on the acceptance rate)is used.</p>
<p>References: Bélisle, C. J. (1992). Convergence theorems for a class of simulated annealing algorithms on rd. Journal of Applied Probability, 885–895.</p>
<p>C. J. Geyer (2011) Importance sampling, simulated tempering, and umbrella sampling, in the Handbook of Markov Chain Monte Carlo, S. P. Brooks, et al (eds), Chapman &amp; Hall/CRC.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">temperingFunction &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="dv">5</span> <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span><span class="fl">0.01</span><span class="op">*</span>x) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
settings &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">iterations =</span> iter, <span class="dt">adapt =</span> F, <span class="dt">DRlevels =</span> <span class="dv">1</span>, <span class="dt">gibbsProbabilities =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>), <span class="dt">temperingFunction =</span> temperingFunction, <span class="dt">optimize =</span> T,  <span class="dt">message =</span> <span class="ot">FALSE</span>)
out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMCMC.html">runMCMC</a></span>(<span class="dt">bayesianSetup =</span> bayesianSetup, <span class="dt">sampler =</span> <span class="st">"Metropolis"</span>, <span class="dt">settings =</span> settings)
<span class="kw">plot</span>(out) </code></pre></div>
</div>
</div>
<div id="differential-evolution-mcmc" class="section level3">
<h3 class="hasAnchor">
<a href="#differential-evolution-mcmc" class="anchor"></a>Differential Evolution MCMC</h3>
<p>The BT package implements two versions of the differential evolution MCMC. In doubt, you should use the DEzs option.</p>
<p>The first is the normal DE MCMC, corresponding to Ter Braak, Cajo JF. “A Markov Chain Monte Carlo version of the genetic algorithm Differential Evolution: easy Bayesian computing for real parameter spaces.” Statistics and Computing 16.3 (2006): 239-249. In this sampler multiple chains are run in parallel (but not in the sense of parallel computing). The main diference to the Metrpolis based algorithms is the creation of the propsal. Generally all samplers use the current positin of the chain and add a step in the parameter space to generate a new proposal. Whereas in the Metropolis based sampler this step is usually drawn from a multivariate normal distribution (yet every distribution is possible), the DE sampler uses the current position of two other chains to generate the step for each chain. For sucessful sampling at least 2*d chains, with d being the number of parameters, need to be run in parallel.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">settings &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">iterations =</span> iter,  <span class="dt">message =</span> <span class="ot">FALSE</span>)
out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMCMC.html">runMCMC</a></span>(<span class="dt">bayesianSetup =</span> bayesianSetup, <span class="dt">sampler =</span> <span class="st">"DE"</span>, <span class="dt">settings =</span> settings)
<span class="kw">plot</span>(out) </code></pre></div>
<p>The second is the Differential Evolution MCMC with snooker update and sampling from past states, corresponding to ter Braak, Cajo JF, and Jasper A. Vrugt. “Differential evolution Markov chain with snooker updater and fewer chains.” Statistics and Computing 18.4 (2008): 435-446. This extension covers two differences to the normal DE MCMC. First a snooker update is used based on a user defined probability. Second also past states of other chains are respected in the creation of the proposal. These extensions allow for fewer chains (i.e. 3 chains are usually enough for up to 200 parameters) and parallel computing as the current position of each chain is only dependent on the past states of the other chains.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">settings &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">iterations =</span> iter,  <span class="dt">message =</span> <span class="ot">FALSE</span>)
out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMCMC.html">runMCMC</a></span>(<span class="dt">bayesianSetup =</span> bayesianSetup, <span class="dt">sampler =</span> <span class="st">"DEzs"</span>, <span class="dt">settings =</span> settings)
<span class="kw">plot</span>(out) </code></pre></div>
</div>
<div id="dream-sampler" class="section level3">
<h3 class="hasAnchor">
<a href="#dream-sampler" class="anchor"></a>DREAM sampler</h3>
<p>Also for the DREAM sampler, there are two versions included. First of all, the standard DREAM sampler, see Vrugt, Jasper A., et al. “Accelerating Markov chain Monte Carlo simulation by differential evolution with self-adaptive randomized subspace sampling.” International Journal of Nonlinear Sciences and Numerical Simulation 10.3 (2009): 273-290.</p>
<p>This sampler is largely build on the DE sampler with some significant differences: 1) More than two chains can be used to generate a proposal. 2) A randomized subspace sampling can be used to enhance the efficiency for high dimensional posteriors. Each dimension is updated with a crossover probalitity CR. To speed up the exploration of the posterior DREAM adapts the distribution of CR values during burn-in to favor large jumps over small ones. 3) Outlier chains can be removed during burn-in.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">settings &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">iterations =</span> iter,  <span class="dt">message =</span> <span class="ot">FALSE</span>)
out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMCMC.html">runMCMC</a></span>(<span class="dt">bayesianSetup =</span> bayesianSetup, <span class="dt">sampler =</span> <span class="st">"DREAM"</span>, <span class="dt">settings =</span> settings)
<span class="kw">plot</span>(out) </code></pre></div>
<p>The second implementation uses the same extension as the DEzs sampler. Namely sampling from past states and a snooker update. Also here this extension allows for the use of fewer chains and parallel computing.</p>
<p>Again, in doubt you should prefer “DREAMzs”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">settings &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">iterations =</span> iter,  <span class="dt">message =</span> <span class="ot">FALSE</span>)
out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMCMC.html">runMCMC</a></span>(<span class="dt">bayesianSetup =</span> bayesianSetup, <span class="dt">sampler =</span> <span class="st">"DREAMzs"</span>, <span class="dt">settings =</span> settings)
<span class="co">#plot(out) </span></code></pre></div>
</div>
<div id="t-walk" class="section level3">
<h3 class="hasAnchor">
<a href="#t-walk" class="anchor"></a>T-walk</h3>
<p>The T-walk is a MCMC algorithm developed by Christen, J. Andrés, and Colin Fox. “A general purpose sampling algorithm for continuous distributions (the t-walk).” Bayesian Analysis 5.2 (2010): 263-281. In the sampler two independent points are used to explore the posterior space. Based on probabilities four different moves are used to generate proposals for the two points. As for the DE sampler this procedure requires no tuning of the proposal distribution for efficient sampling in complex posterior distributions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">settings =<span class="st"> </span><span class="kw">list</span>(<span class="dt">iterations =</span> iter,  <span class="dt">message =</span> <span class="ot">FALSE</span>) 

out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMCMC.html">runMCMC</a></span>(<span class="dt">bayesianSetup =</span> bayesianSetup, <span class="dt">sampler =</span> <span class="st">"Twalk"</span>, <span class="dt">settings =</span> settings)</code></pre></div>
</div>
<div id="convergence-checks-for-mcmcs" class="section level3">
<h3 class="hasAnchor">
<a href="#convergence-checks-for-mcmcs" class="anchor"></a>Convergence checks for MCMCs</h3>
<p>All MCMCs should be checked for convergence. We recommend the standard procedure of Gelmal-Rubin. This procedure requires running several MCMCs (we recommend 3). This can be achieved either directly in the runMCMC (nrChains = 3), or, for runtime reasons, by combining the results of three independent runMCMC evaluations with nrChains = 1.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">settings &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">iterations =</span> iter, <span class="dt">nrChains =</span> <span class="dv">3</span>,  <span class="dt">message =</span> <span class="ot">FALSE</span>)
out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMCMC.html">runMCMC</a></span>(<span class="dt">bayesianSetup =</span> bayesianSetup, <span class="dt">sampler =</span> <span class="st">"Metropolis"</span>, <span class="dt">settings =</span> settings)
<span class="kw">plot</span>(out)</code></pre></div>
<p><img src="BayesianTools_files/figure-html/unnamed-chunk-35-1.png" width="480"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#chain = getSample(out, coda = T)</span>
<span class="kw"><a href="../reference/gelmanDiagnostics.html">gelmanDiagnostics</a></span>(out, <span class="dt">plot =</span> F)</code></pre></div>
<pre><code>## Potential scale reduction factors:
## 
##       Point est. Upper C.I.
## par 1          1       1.00
## par 2          1       1.01
## par 3          1       1.01
## 
## Multivariate psrf
## 
## 1</code></pre>
</div>
</div>
<div id="non-mcmc-sampling-algorithms" class="section level2">
<h2 class="hasAnchor">
<a href="#non-mcmc-sampling-algorithms" class="anchor"></a>Non-MCMC sampling algorithms</h2>
<p>MCMCs sample the posterior space by creating a chain in parameter space. While this allows “learning” from past steps, it does not permit the parallel execution of a large number of posterior values at the same time.</p>
<p>An alternative to MCMCs are particle filters, aka Sequential Monte-Carlo (SMC) algorithms. See Hartig, F.; Calabrese, J. M.; Reineking, B.; Wiegand, T. &amp; Huth, A. Statistical inference for stochastic simulation models - theory and application Ecol. Lett., 2011, 14, 816-827</p>
<div id="rejection-samling" class="section level3">
<h3 class="hasAnchor">
<a href="#rejection-samling" class="anchor"></a>Rejection samling</h3>
<p>The easiest option is to simply sample a large number of parameters and accept them according to their posterior value. This option can be emulated with the implemented SMC, setting iterations to 1.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">settings &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">initialParticles =</span> iter, <span class="dt">iterations=</span> <span class="dv">1</span>)
out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMCMC.html">runMCMC</a></span>(<span class="dt">bayesianSetup =</span> bayesianSetup, <span class="dt">sampler =</span> <span class="st">"SMC"</span>, <span class="dt">settings =</span> settings)
<span class="kw">plot</span>(out) </code></pre></div>
</div>
<div id="sequential-monte-carlo-smc" class="section level3">
<h3 class="hasAnchor">
<a href="#sequential-monte-carlo-smc" class="anchor"></a>Sequential Monte Carlo (SMC)</h3>
<p>The more sophisticated option is using the implemented SMC, which is basically a particle filter that applies several filter steps.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">settings &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">initialParticles =</span> iter, <span class="dt">iterations=</span> <span class="dv">10</span>)
out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMCMC.html">runMCMC</a></span>(<span class="dt">bayesianSetup =</span> bayesianSetup, <span class="dt">sampler =</span> <span class="st">"SMC"</span>, <span class="dt">settings =</span> settings)
<span class="kw">plot</span>(out) </code></pre></div>
<p>Note that the use of a number for initialParticles requires that the bayesianSetup includes the possibility to sample from the prior.</p>
</div>
</div>
</div>
<div id="model-comparison-and-averaging" class="section level1">
<h1 class="hasAnchor">
<a href="#model-comparison-and-averaging" class="anchor"></a>Model comparison and averaging</h1>
<p>There are a number of Bayesian model selection and model comparison methods. The BT implements three of the most common of them, the DIC, the WAIC, and the Bayes factor.</p>
<ul>
<li><p>On the Bayes factor, see Kass, R. E. &amp; Raftery, A. E. Bayes Factors J. Am. Stat. Assoc., Amer Statist Assn, 1995, 90, 773-795</p></li>
<li><p>An overview on DIC and WAIC is given in Gelman, A.; Hwang, J. &amp; Vehtari, A. (2014) Understanding predictive information criteria for Bayesian models. Statistics and Computing, 24, 997-1016-. On DIC, see also the original reference by Spiegelhalter, D. J.; Best, N. G.; Carlin, B. P. &amp; van der Linde, A. (2002) Bayesian measures of model complexity and fit. J. Roy. Stat. Soc. B, 64, 583-639.</p></li>
</ul>
<p>The Bayes factor relies on the calculation of marginal likelihoods, which is numerically not without problems. The BT package currently implements three methods</p>
<ul>
<li><p>The recommended way is the method “Chib” (Chib and Jeliazkov, 2001). which is based on MCMC samples, but performs additional calculations. Despite being the current recommendation, note there are some numeric issues with this algorithm that may limit reliability for larger dimensions.</p></li>
<li><p>The harmonic mean approximation, is implemented only for comparison. Note that the method is numerically unrealiable and usually should not be used.</p></li>
<li><p>The third method is simply sampling from the prior. While in principle unbiased, it will only converge for a large number of samples, and is therefore numerically inefficient.</p></li>
</ul>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>Data linear Regression with quadratic and linear effect</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sampleSize =<span class="st"> </span><span class="dv">30</span>
x &lt;-<span class="st"> </span>(<span class="op">-</span>(sampleSize<span class="op">-</span><span class="dv">1</span>)<span class="op">/</span><span class="dv">2</span>)<span class="op">:</span>((sampleSize<span class="op">-</span><span class="dv">1</span>)<span class="op">/</span><span class="dv">2</span>)
y &lt;-<span class="st">  </span><span class="dv">1</span> <span class="op">*</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">*</span>x<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n=</span>sampleSize,<span class="dt">mean=</span><span class="dv">0</span>,<span class="dt">sd=</span><span class="dv">10</span>)
<span class="kw">plot</span>(x,y, <span class="dt">main=</span><span class="st">"Test Data"</span>)</code></pre></div>
<p><img src="BayesianTools_files/figure-html/unnamed-chunk-38-1.png" width="480"></p>
<p>Likelihoods for both</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">likelihood1 &lt;-<span class="st"> </span><span class="cf">function</span>(param){
    pred =<span class="st"> </span>param[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>param[<span class="dv">2</span>]<span class="op">*</span>x <span class="op">+</span><span class="st"> </span>param[<span class="dv">3</span>] <span class="op">*</span><span class="st"> </span>x<span class="op">^</span><span class="dv">2</span>
    singlelikelihoods =<span class="st"> </span><span class="kw">dnorm</span>(y, <span class="dt">mean =</span> pred, <span class="dt">sd =</span> <span class="dv">1</span><span class="op">/</span>(param[<span class="dv">4</span>]<span class="op">^</span><span class="dv">2</span>), <span class="dt">log =</span> T)
    <span class="kw">return</span>(<span class="kw">sum</span>(singlelikelihoods))  
}

likelihood2 &lt;-<span class="st"> </span><span class="cf">function</span>(param){
    pred =<span class="st"> </span>param[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>param[<span class="dv">2</span>]<span class="op">*</span>x 
    singlelikelihoods =<span class="st"> </span><span class="kw">dnorm</span>(y, <span class="dt">mean =</span> pred, <span class="dt">sd =</span> <span class="dv">1</span><span class="op">/</span>(param[<span class="dv">3</span>]<span class="op">^</span><span class="dv">2</span>), <span class="dt">log =</span> T)
    <span class="kw">return</span>(<span class="kw">sum</span>(singlelikelihoods))  
}</code></pre></div>
<p>Posterior definitions</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">setUp1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/createBayesianSetup.html">createBayesianSetup</a></span>(likelihood1, <span class="dt">lower =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">5</span>,<span class="op">-</span><span class="dv">5</span>,<span class="op">-</span><span class="dv">5</span>,<span class="fl">0.01</span>), <span class="dt">upper =</span> <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">30</span>))

setUp2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/createBayesianSetup.html">createBayesianSetup</a></span>(likelihood2, <span class="dt">lower =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">5</span>,<span class="op">-</span><span class="dv">5</span>,<span class="fl">0.01</span>), <span class="dt">upper =</span> <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">30</span>))</code></pre></div>
<p>MCMC and marginal likelihood calculation</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">settings =<span class="st"> </span><span class="kw">list</span>(<span class="dt">iterations =</span> <span class="dv">15000</span>,  <span class="dt">message =</span> <span class="ot">FALSE</span>)
out1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMCMC.html">runMCMC</a></span>(<span class="dt">bayesianSetup =</span> setUp1, <span class="dt">sampler =</span> <span class="st">"Metropolis"</span>, <span class="dt">settings =</span> settings)
<span class="co">#tracePlot(out1, start = 5000)</span>
M1 =<span class="st"> </span><span class="kw"><a href="../reference/marginalLikelihood.html">marginalLikelihood</a></span>(out1)
M1

settings =<span class="st"> </span><span class="kw">list</span>(<span class="dt">iterations =</span> <span class="dv">15000</span>,  <span class="dt">message =</span> <span class="ot">FALSE</span>)
out2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMCMC.html">runMCMC</a></span>(<span class="dt">bayesianSetup =</span> setUp2, <span class="dt">sampler =</span> <span class="st">"Metropolis"</span>, <span class="dt">settings =</span> settings)
<span class="co">#tracePlot(out2, start = 5000)</span>
M2 =<span class="st"> </span><span class="kw"><a href="../reference/marginalLikelihood.html">marginalLikelihood</a></span>(out2)
M2</code></pre></div>
<div id="model-comparison-via-bayes-factor" class="section level3">
<h3 class="hasAnchor">
<a href="#model-comparison-via-bayes-factor" class="anchor"></a>Model comparison via Bayes factor</h3>
<p>Bayes factor (need to reverse the log)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">exp</span>(M1<span class="op">$</span>marginalLikelihod <span class="op">-</span><span class="st"> </span>M2<span class="op">$</span>marginalLikelihod)</code></pre></div>
<pre><code>## numeric(0)</code></pre>
<p>BF &gt; 1 means the evidence is in favor of M1. See Kass, R. E. &amp; Raftery, A. E. (1995) Bayes Factors. J. Am. Stat. Assoc., Amer Statist Assn, 90, 773-795.</p>
<p>Note that we would have to multiply still with the model priors to arrive at Bayesian model weights.</p>
</div>
<div id="model-comparison-via-dic" class="section level3">
<h3 class="hasAnchor">
<a href="#model-comparison-via-dic" class="anchor"></a>Model comparison via DIC</h3>
<p>The Deviance information criterion is a commonly applied method to summarize the fit of an MCMC chain. It can be obtained via</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/DIC.html">DIC</a></span>(out1)<span class="op">$</span>DIC</code></pre></div>
<pre><code>## [1] 499331805</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/DIC.html">DIC</a></span>(out2)<span class="op">$</span>DIC</code></pre></div>
<pre><code>## [1] 365.1629</code></pre>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#quick-start">Quick start</a><ul class="nav nav-pills nav-stacked">
<li><a href="#installing-loading-and-citing-the-package">Installing, loading and citing the package</a></li>
      <li><a href="#the-bayesian-setup">The Bayesian Setup</a></li>
      <li><a href="#running-mcmc-and-smc-functions">Running MCMC and SMC functions</a></li>
      </ul>
</li>
      <li>
<a href="#bayesiansetup-reference">BayesianSetup Reference</a><ul class="nav nav-pills nav-stacked">
<li><a href="#reference-on-creating-likelihoods">Reference on creating likelihoods</a></li>
      <li><a href="#reference-on-creating-priors">Reference on creating priors</a></li>
      </ul>
</li>
      <li>
<a href="#mcmc-sampler-reference">MCMC sampler reference</a><ul class="nav nav-pills nav-stacked">
<li><a href="#runmcmc">runMCMC</a></li>
      <li><a href="#the-different-mcmc-samplers">The different MCMC samplers</a></li>
      <li><a href="#non-mcmc-sampling-algorithms">Non-MCMC sampling algorithms</a></li>
      </ul>
</li>
      <li>
<a href="#model-comparison-and-averaging">Model comparison and averaging</a><ul class="nav nav-pills nav-stacked">
<li><a href="#example">Example</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Florian Hartig, Francesco Minunno, Stefan  Paul.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
